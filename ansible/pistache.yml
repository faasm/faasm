---

- hosts: localhost
  gather_facts: no
  tasks:
    - name: "Clone Pistache"
      git:
        repo: "https://github.com/oktal/pistache.git"
        dest: "/tmp/pistache"
        version: "fc16ec32e8364e5e47fb367e9fe0da05e275f5cf"

    - name: "Set up build"
      shell: "{{ item }}"
      args:
        chdir: "/tmp/pistache"
      with_items:
      - "git submodule update --init"
      - "mkdir -p build"

    - name: "Build"
      shell: "{{ item }}"
      args:
        chdir: "/tmp/pistache/build"
      with_items:
      - 'cmake -G "Unix Makefiles" -DCMAKE_BUILD_TYPE=Release ..'
      - "make"

    - name: "Install"
      become: yes
      shell: "sudo make install"
      args:
        chdir: "/usr/local/code/lib/pistache/build"

    - name: "Clean up"
      shell: "rm -rf /tmp/pistache"
